Mendelian Randomisation Harmonisation Scripts

This repository contains two complementary R scripts for running Mendelian randomisation without depending on the TwoSampleMR package. They perform the same basic steps – allele harmonisation, per-SNP Wald ratios, and per-outcome fixed-effect IVW – but they differ in the input format they expect and how robustly they handle strand and build issues.

The first script, manual_mr_harmonise.R, is designed for situations where you already have TwoSampleMR-formatted exposure and outcome files. It expects columns like SNP, beta.exposure, se.exposure, effect_allele.exposure, and other_allele.exposure for the exposure, and SNP, beta.outcome, se.outcome, effect_allele.outcome, other_allele.outcome, and id.outcome for the outcome. Optional effect-allele frequency columns can be used to keep palindromic SNPs that are far from 0.5. This script joins exposure and outcome by SNP (rsID), drops palindromic SNPs by default, flips the sign of outcome betas where alleles are swapped, computes per-SNP Wald ratios, and then aggregates to per-outcome MR estimates. It is fast and minimal for clean, pre-formatted datasets – for example, when you want to test fine-mapped vigorous-activity SNPs against CpG methylation outcomes.

The second script, posjoin_mr_pipeline.R, is for cases where you start from raw cis-mQTL or other GWAS tables that only have chromosome and position information. It reads in your exposure file with SNP_chr, SNP_pos, alleles and effect sizes, and an outcome GWAS with chromosome/position and effect/other allele columns. It joins by genomic position (GRCh37), guards palindromic SNPs conservatively, performs strand-complement rescue for non-palindromic mismatches, and drops indels and multiallelic variants. This script also writes a diagnostics file showing how many SNPs overlapped per outcome before harmonisation. It is safer when rsIDs are messy or the genome build is uncertain.

Both scripts assume exposure and outcome use A/C/G/T alleles on the same genome build. Both output a harmonised SNP-level CSV and a per-outcome MR results CSV with the effect estimate, standard error, p-value, number of SNPs, and method used. The position-join script additionally writes an overlap diagnostics CSV. In short: use manual_mr_harmonise.R when your data are already in TwoSampleMR format with reliable rsIDs, and use posjoin_mr_pipeline.R when you have raw tables or need stronger allele and strand QC.
